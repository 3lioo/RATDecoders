from pprint import pprint
from malwareconfig import fileparser

from malwareconfig.yarascanner import YaraScanner
from malwareconfig.modules import __decoders__

sample_path = '/home/thehermit/Documents/RATS/blackshades/BlackShades.exe'


print("[+] Loading Decoders")
for name in __decoders__.keys():
    print("  [-] Loaded: {0}".format(name))



# Open and parse the file
print("[+] Loading File")
file_info = fileparser.FileParser(file_path=sample_path)
# Scan with yara
print("  [-] Scanning File")
scanner = YaraScanner()
scanner.yara_scan(file_info.file_data)

family_name = scanner.rule_list[0]

print("  [-] Detected: {0}".format(family_name))

# Use the yara results to select the correct decoder

print("  [-] Running Decoder")
if family_name in __decoders__:
    module = __decoders__[family_name]['obj']()
    module.set_file(file_info)
    module.get_config()
    conf = module.config

    print("  [-] Config Output\n")
    pprint(conf)
